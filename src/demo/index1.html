<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Angular Resizable</title>
    <link rel="stylesheet" href="css/normalize.css">
    <!-- <link rel="stylesheet" href="css/bootstrap.min.css"> -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" /> 
    
    <link href='http://fonts.googleapis.com/css?family=Varela+Round' rel='stylesheet' type='text/css'>
    
    <link rel="stylesheet" href="css/flexboxgrid.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/customized.css">

    <style>
        .container-fluid {
            border: 2px solid blue;
        }
        iframe {
            width: 100%
        }

    </style>


</head>

<body>

    <body ng-app="angularResizable">
        <!-- <main> -->
        <!-- <nav resizable r-directions="['right']">
            <span class="icon-big icon_expand-1"></span>
            <br /><br />
            <h1>
              Angular
              Resizable
            </h1>
            <p>
              A teensy weensy directive for creating resizable containers.
            </p>
        </nav> -->

         <div class="toolbar">
            <ul></ul>
        </div>

        <div class="content container-fluid">
            <div class="row" resizable r-directions="['bottom']" r-flex="true">
                <section resizable r-directions="['right']" r-flex="true" class="col-lg-7 col-md-7">
                    <!-- <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3>Panel 1</h3>
                            <div class="panel-control">
                                <a class="close-control" href="#"><span class="glyphicon glyphicon-remove"></span></a>
                                <a href="#" class="maximize-control"><span class="glyphicon glyphicon-resize-full"></span></a>
                            </div>
                        </div>
                        <div class="panel-body">
                            <iframe src="http://bbc.com" frameborder="0"></iframe>
                        </div>
                    </div> -->
                </section>
                <section resizable r-directions="['right']" r-flex="true" class="col-lg-3 col-md-3">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3>Panel 2</h3>
                            <div class="panel-control">
                                <a class="close-control" href="#"><span class="glyphicon glyphicon-remove"></span></a>
                                <a href="#" class="maximize-control"><span class="glyphicon glyphicon-resize-full"></span></a>
                            </div>
                        </div>
                        <div class="panel-body">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Tempora repellat saepe voluptatibus ipsum! Consequuntur consectetur expedita amet provident totam, ducimus, assumenda sint, minus architecto culpa, voluptatem veritatis nesciunt molestias deserunt.</p>
                        </div>
                    </div>
                </section>
                <section class="col-lg-2 col-md-2">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3>Panel 3</h3>
                            <div class="panel-control">
                                <a class="close-control" href="#"><span class="glyphicon glyphicon-remove"></span></a>
                                <a href="#" class="maximize-control"><span class="glyphicon glyphicon-resize-full"></span></a>
                            </div>
                        </div>
                        <div class="panel-body">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Tempora repellat saepe voluptatibus ipsum! Consequuntur consectetur expedita amet provident totam, ducimus, assumenda sint, minus architecto culpa, voluptatem veritatis nesciunt molestias deserunt.</p>
                        </div>
                    </div>
                </section>
            </div>
            <div class="row">
                <section id="three" resizable r-directions="['right']" r-flex="true" class="col-lg-8 col-md-8">
                <!-- <section id="three" class="col-lg-8 col-md-8 col-sm-8"> -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3>Panel 4</h3>
                            <div class="panel-control">
                                <a class="close-control" href="#"><span class="glyphicon glyphicon-remove"></span></a>
                                <a href="#" class="maximize-control"><span class="glyphicon glyphicon-resize-full"></span></a>
                            </div>
                        </div>
                        <div class="panel-body">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Tempora repellat saepe voluptatibus ipsum! Consequuntur consectetur expedita amet provident totam, ducimus, assumenda sint, minus architecto culpa, voluptatem veritatis nesciunt molestias deserunt.</p>
                        </div>
                    </div>
                </section>
                <section id="four" class="col-lg-4 col-md-4">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3>Panel 5</h3>
                            <div class="panel-control">
                                <a class="close-control" href="#"><span class="glyphicon glyphicon-remove"></span></a>
                                <a href="#" class="maximize-control"><span class="glyphicon glyphicon-resize-full"></span></a>
                            </div>
                        </div>
                        <div class="panel-body">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Tempora repellat saepe voluptatibus ipsum! Consequuntur consectetur expedita amet provident totam, ducimus, assumenda sint, minus architecto culpa, voluptatem veritatis nesciunt molestias deserunt.</p>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        <!-- </main> -->
    </body>
    <script src='http://ajax.googleapis.com/ajax/libs/angularjs/1.3.2/angular.min.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script src="js/index.js"></script>
    <script>
    $(function() {
        $('.panel').each(function() {
            console.log(' :' + $(this).closest('section').height());
            $(this).height($(this).closest('section').height() - 30);
            $(this).find('.panel-body').height($(this).closest('.panel').height() - 80);

        })


        $('.rg-right').mousedown(function(){
            console.log('test');   

            $(this).closest('.row').children('section').each(function(){
                   $(this).removeClass(function (index, css) {
                        return (css.match (/\bcol-\S+/g) || []).join(' ');
                    })
                   console.log('removed');

               })  

        })


        $('.rg-bottom').mouseup(function(event) {

            $('.panel').each(function() {
                if ($(this).height() > $(this).closest('section').height()) {
                    $(this).height($(this).closest('section').height());
                    $(this).find('.panel-body').height($(this).closest('.panel').height() - 100);
                }
                //console.log('sectionHeight :' + $(this).closest('section').height() + 'panelHeight: ' + $(this).height());

                if ($(this).closest('section').height() - $(this).height() > 30) {
                    $(this).height($(this).closest('section').height());
                    $(this).find('.panel-body').height($(this).closest('.panel').height() - 100);
                }
            })

            $('iframe').each(function(){
                //$(this).height($(this).closest('.panel-body'));
                //$(this).contents().height($(this).contents().find("html").height());
                //$(this).height($(this).closest('.panel-body').height()+80);
                console.log('heightContiner :'+$(this).closest('.panel-body').height());
                $(this).height($(this).closest('.panel-body').height()-10);
            })

        });

    });

    // ========= controls code BEGIN
        var collapsedPanels = [];
        function pushPanel(rPH, PH) {
            if (collapsedPanels.indexOf(rPH) < 0) {
                    console.log('not found :'+rPH);
                    collapsedPanels.push(rPH);
                    $('.toolbar ul').append('<li><a href="#" data-panelid="'+rPH+'">'+PH+'</a></li>');
                }
                console.log('collapsedPanels :'+collapsedPanels);
        }


        $('.close-control').click(function(){
            var panelHeading = $(this).closest('.panel-control').prev('h3').text().toLowerCase();
            var refinedPanelHeading = panelHeading.replace(" ","_");
            var visiblePanels = $(this).closest('.row').children('section:visible').length;

            $(this).closest('section').attr('id',refinedPanelHeading);
            $(this).closest('section').hide();
            pushPanel(refinedPanelHeading, panelHeading);

            /*$('.toolbar ul').append('<li><a href="#" data-panelid="'+refinedPanelHeading+'">'+panelHeading+'</a></li>');*/

            $('.row').each(function(){
                var sections = $(this).children('section:visible').length;
                var visibles = $(this).children('section.resizable:visible').length;
                if ($(this).children('section.resizable:visible').length >= 1  && visibles == sections) {
                    $(this).children('section.resizable:visible').addClass('fullFlexBasis');
                }
            })
            

            if (visiblePanels === 1) {
                $(this).closest('.row').hide();
            }
            else {
                $(this).closest('.row').show();
            }

        });

        $('.maximize-control').click(function(){
            var currentSection = $(this).closest('section');
            var currentRow = $(this).closest('.row');
            $('section').not(currentSection).each(function(){
                var $thisSection = $(this);
                var panelHeading = $thisSection.find('h3').text().toLowerCase();
                var refinedPanelHeading = panelHeading.replace(" ","_");
                $thisSection.attr('id',refinedPanelHeading);
                $thisSection.hide();
                pushPanel(refinedPanelHeading, panelHeading);
                /*$('.toolbar ul').append('<li><a href="#" data-panelid="'+refinedPanelHeading+'">'+panelHeading+'</a></li>');*/
            });
            $(this).hide();

            $('.row').not(currentRow).each(function(){
                $(this).hide();
            })

            currentSection.addClass('fullFlexBasis');



        });

        $('body').on('click','.toolbar a', function(){
            var panelID = $(this).data('panelid');
            collapsedPanels.splice(collapsedPanels.indexOf(panelID),1);
            console.log('collapsedPanels :'+collapsedPanels);
            $('#'+panelID).closest('.row').show();
            $('#'+panelID).show();
            $(this).closest('li').remove();
            $('.maximize-control').show();
            $('.row').each(function(){
                var sections = $(this).children('section:visible').length;
                var visibles = $(this).children('section.resizable:visible').length;


                console.log('resizable: '+$(this).children('section.resizable:visible').length);
                console.log('sections: '+$(this).children('section:visible').length);
                if ($(this).children('section.resizable:visible').length >= 1  && visibles == sections) {
                    $(this).children('section.resizable:visible').addClass('fullFlexBasis');
                }
                else {
                    $(this).children('section').removeClass('fullFlexBasis');
                }
            })

            $('section.resizable:visible').each(function(){
                $(this).css('flex-basis','');
            })

            $('.maximize-control').each(function(){
                $(this).show();
            })
        });

    // ========= controls code END



    document.addEventListener("DOMContentLoaded", function(event) {
        document.addEventListener("mousedown", function(e) {
            var iframes = document.getElementsByTagName("iframe");

            for (var i = 0; i < iframes.length; i++) {
                iframes[i].style.pointerEvents = "none";
            }
        }, true);
        document.addEventListener("mouseup", function(e) {
            var iframes = document.getElementsByTagName("iframe");

            for (var i = 0; i < iframes.length; i++) {
                iframes[i].style.pointerEvents = "auto";
            }
        }, true);
    });
    </script>
</body>

</html>
